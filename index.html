<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Şarj, Cihaz ve IP Bilgisi</title>
</head>
<body>
  <h2>Cihaz Bilgileri Gönderiliyor...</h2>
  <p id="status">Yükleniyor...</p>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-app.js";
    import { getDatabase, ref, push } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-database.js";

    // Firebase yapılandırması
    const firebaseConfig = {
      apiKey: "AIzaSyA2ZZ7moCVLTi3LjwToDvqPg11e9KVIMgw",
      authDomain: "arazyazilim.firebaseapp.com",
      databaseURL: "https://arazyazilim-default-rtdb.firebaseio.com",
      projectId: "arazyazilim",
      storageBucket: "arazyazilim.appspot.com",
      messagingSenderId: "911734141067",
      appId: "1:911734141067:web:8dd3532898c8ee16ed648e"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const statusEl = document.getElementById("status");

    function getDeviceInfo() {
      const ua = navigator.userAgent;
      let model = "Bilinmiyor";
      if (ua.includes("Android")) {
        const match = ua.match(/(.*?)/);
        if (match && match[1]) model = match[1];
      } else if (ua.includes("iPhone")) {
        model = "iPhone";
      } else if (ua.includes("iPad")) {
        model = "iPad";
      } else if (ua.includes("Windows")) {
        model = "Windows Cihaz";
      } else if (ua.includes("Macintosh")) {
        model = "Mac";
      }
      return { model, userAgent: ua };
    }

    async function getIP() {
      try {
        const response = await fetch("https://api.ipify.org?format=json");
        const data = await response.json();
        return data.ip;
      } catch (err) {
        return "IP alınamadı";
      }
    }

    async function sendData() {
      const deviceInfo = getDeviceInfo();
      const ipAddress = await getIP();

      if ('getBattery' in navigator) {
        navigator.getBattery().then(battery => {
          const level = Math.round(battery.level * 100);
          const charging = battery.charging;

          push(ref(db, "batteryData"), {
            level: level,
            charging: charging,
            timestamp: Date.now(),
            deviceModel: deviceInfo.model,
            userAgent: deviceInfo.userAgent,
            ipAddress: ipAddress
          }).then(() => {
            statusEl.innerText = `Şarj: %${level}, Model: ${deviceInfo.model}, IP: ${ipAddress} → Gönderildi.`;
          }).catch(err => {
            statusEl.innerText = "Firebase gönderim hatası: " + err.message;
          });
        }).catch(err => {
          statusEl.innerText = "Battery API hatası: " + err.message;
        });
      } else {
        statusEl.innerText = "Tarayıcı Battery API'yi desteklemiyor.";
      }
    }

    sendData();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Şarj Bilgisi</title>
</head>
<body>
  <h2>Şarj Bilgisi Gönderiliyor...</h2>
  <p id="status">Yükleniyor...</p>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-app.js";
    import { getDatabase, ref, push } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA2ZZ7moCVLTi3LjwToDvqPg11e9KVIMgw",
      authDomain: "arazyazilim.firebaseapp.com",
      databaseURL: "https://arazyazilim-default-rtdb.firebaseio.com",
      projectId: "arazyazilim",
      storageBucket: "arazyazilim.appspot.com",
      messagingSenderId: "911734141067",
      appId: "1:911734141067:web:8dd3532898c8ee16ed648e"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const statusEl = document.getElementById("status");

    if ('getBattery' in navigator) {
      navigator.getBattery().then(battery => {
        const level = Math.round(battery.level * 100);
        const charging = battery.charging;

        push(ref(db, "batteryLevels"), {
          level: level,
          charging: charging,
          timestamp: Date.now(),
          userAgent: navigator.userAgent
        }).then(() => {
          statusEl.innerText = `Şarj: %${level} (${charging ? "Şarj oluyor" : "Şarj olmuyor"}) - Gönderildi.`;
        }).catch(err => {
          statusEl.innerText = "Gönderim hatası: " + err.message;
        });
      }).catch(err => {
        statusEl.innerText = "Battery API hatası: " + err.message;
      });
    } else {
      statusEl.innerText = "Tarayıcı Battery API'yi desteklemiyor.";
    }
  </script>
</body>
</html>
